{% extends "base.html" %}

{% block content %}
  <h2 class="section-title">✏️ Editar Lançamento</h2>

  <form method="POST" class="card p-4 mb-4">
    <div class="mb-3">
      <label for="data" class="form-label">Data</label>
      <input type="date" class="form-control" id="data" name="data" value="{{ lancamento.data }}" required>
    </div>

    <div class="mb-3">
      <label for="descricao" class="form-label">Descrição</label>
      <input type="text" class="form-control" id="descricao" name="descricao" value="{{ lancamento.descricao }}" required>
    </div>

    <div class="mb-3">
      <label for="estabelecimento" class="form-label">Estabelecimento</label>
      <input type="text" class="form-control" id="estabelecimento" name="estabelecimento" value="{{ lancamento.estabelecimento }}">
    </div>    
    <div class="form-text text-muted" id="categoriaSugestao">
        Sugestão: (aguardando texto)
    </div>

    <div class="mb-3">
      <label for="valor" class="form-label">Valor</label>
      <input type="number" step="0.01" class="form-control" id="valor" name="valor" value="{{ lancamento.valor }}" required>
    </div>

    <div class="mb-3">
      <label for="tipo" class="form-label">Tipo</label>
      <select class="form-select" id="tipo" name="tipo" required>
        <option value="Receita" {% if lancamento.tipo == 'Receita' %}selected{% endif %}>Receita</option>
        <option value="Despesa" {% if lancamento.tipo == 'Despesa' %}selected{% endif %}>Despesa</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="forma_pagamento" class="form-label">Forma de Pagamento</label>
      <input type="text" class="form-control" id="forma_pagamento" name="forma_pagamento" value="{{ lancamento.forma_pagamento }}">
    </div>

    <button type="submit" class="btn btn-success">
      <i class="bi bi-check-circle me-1"></i> Salvar Alterações
    </button>
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary ms-2">
      <i class="bi bi-arrow-left me-1"></i> Cancelar
    </a>
  </form>


  <script>
  async function sugerirCategoria() {
    const descricao = document.getElementById("descricao").value;
    const estabelecimento = document.getElementById("estabelecimento").value;

    if (descricao.length > 3 || estabelecimento.length > 3) {
      const res = await fetch("/api/classificar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ descricao, estabelecimento })
      });
      const data = await res.json();
      if (data.categoria) {
        document.getElementById("categoriaSugestao").textContent = `Sugestão: ${data.categoria}`;
      }
    }
  }

  document.getElementById("descricao").addEventListener("input", sugerirCategoria);
  document.getElementById("estabelecimento").addEventListener("input", sugerirCategoria);
</script>

{% endblock %}
